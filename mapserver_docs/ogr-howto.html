<?xml version="1.0" encoding="ISO-8859-1"?>
<html>
    <head><title>HOWTO for OGR Use in MapServer</title>
     <meta name="generator" content="DocBook XSL Stylesheets V1.29"/>
    </head>
    <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div id="c36b2" class="article"><div class="titlepage"><div>
         <h1 class="title"><a name="c36b2"/>HOWTO for OGR Use in MapServer</h1>
      </div>
      <div>
         <h3 class="author">Jeff McKenna</h3>
      <div class="affiliation"><span class="orgname">DM Solutions Group Inc.<br/></span><pre class="address">
         <tt>&lt;<a href="mailto:mckenna@dmsolutions.ca">mckenna@dmsolutions.ca</a>&gt;</tt>
         </pre>
      </div></div>
      <div>
         <div class="abstract"><p><a name="c36b2b1c10"/><b>Abstract</b></p><p>
           This document describes the procedures for using OGR vector data sources within MapServer applications.
           </p><p>Last Updated: 05/17/2001</p></div>
      </div><hr/></div>
      <div class="toc"><p><b>Table of Contents</b></p><dl><dt> <a href="#intro">Introduction</a></dt><dd><dl><dt>
         <a href="#definition">What is OGR?</a></dt><dt> <a href="#addtition">What Does OGR Add to MapServer?</a></dt><dt>
         <a href="#supported">What Data Formats are Supported?</a></dt><dt>
         <a href="#information">How to Get More Information on the OGR Project</a></dt></dl></dd><dt>
         <a href="#obtain">Obtaining and Compiling MapServer with OGR Support</a></dt><dt>
         <a href="#integrate">Integrating OGR Support with MapServer Applications</a></dt><dd><dl><dt>
         <a href="#examples">Examples of Layer Definitions Using OGR</a></dt><dt>
         <a href="#ogrinfo">How to Use "OGRINFO"</a></dt><dt>
         <a href="#queries">Queries Through OGR Format</a></dt><dt>
         <a href="#formatinfo">Format-Specific Information</a></dt></dl></dd><dt>
         <a href="#FAQ">FAQ / Common Problems</a></dt><dd><dl><dt>
         <a href="#c36b2b8b2">What Does "OGR" Stand For?</a></dt></dl></dd><dt>
         <a href="#docinfo">About This Document</a></dt><dd><dl><dt>
         <a href="#copyright">Copyright Information</a></dt><dt>
         <a href="#disclaimer">Disclaimer</a></dt><dt>
         <a href="#feedback">Feedback</a></dt></dl></dd></dl>
      </div><div class="sect1"><a name="intro"/>
      <div class="titlepage"><div>
         <h2 class="title" style="clear: all"><a name="intro"/><span class="title">Introduction</span>
         </h2>
      </div></div>
      <p>
        Starting with version 3.5, MapServer included the ability to access
        vector data sets in their native format using the OGR library.
        The following document describes the process for implementing OGR support within MapServer applications.
      </p>
      <p>
        <i>Note that experimental OGR support was included in MapServer version 3.4
        but this initial implementation had some limitations and is not covered in
        this document.
        </i>
      </p>
      <p>
        This document assumes that you are already familiar with certain aspects of MapServer:
      </p>
      <div class="itemizedlist"><ul><li><p><a name="c36b2b2b5b1"/>
        MapServer application development and especially setting up .map files.
      </p></li>
      <li><p><a name="c36b2b2b5b2"/>
        Some compilation skills if you don't have ready access to a precompiled installation
        and need to compile your own copy of MapServer with OGR support.
      </p></li></ul></div>
      <div class="sect2"><a name="definition"/><div class="titlepage"><div><h3 class="title"><a name="definition"/><span class="title">What is OGR?</span></h3></div></div><p>
        The OGR Simple Features Library is a C++ open source library (and commandline tools)
        providing read (and sometimes write) access to a variety of vector file formats
        including ESRI Shapefiles, and MapInfo mid/mif and TAB formats.
      </p></div>
      <div class="sect2"><a name="addtition"/>
      <div class="titlepage">
      <div><h3 class="title"><a name="addtition"/><span class="title">What Does OGR Add to MapServer?</span></h3></div></div>
      <p>
        The OGR Simple Features Library allows MapServer users to display several types of vector data files in their native
        formats.  For example, MapInfo Mid/Mif and TAB data do not need to be converted to ESRI shapefiles
        when using OGR support with MapServer.
      </p></div>
      <div class="sect2"><a name="supported"/>
      <div class="titlepage"><div><h3 class="title"><a name="supported"/><span class="title">What Data Formats are Supported?</span></h3></div></div><p>
        See <a href="http://gdal.velocet.ca/projects/opengis/ogrhtml/ogr_formats.html" target="_top">http://gdal.velocet.ca/projects/opengis/ogrhtml/ogr_formats.html</a> for
        the latest list of supported formats.
        At the date this document was written, the following formats were supported:
                   </p><div class="itemizedlist"><ul><li><p><a name="c36b2b2c11b3b1"/>
        <a href="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_shapefile.html" target="_top">ESRI Shapefiles</a>,
                    </p></li><li><p><a name="c36b2b2c11b3b2"/>
        <a href="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_mitab.html" target="_top">MapInfo TAB and
         MIF/MID files</a>,
        </p></li><li><p><a name="c36b2b2c11b3b3"/>
        <a href="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_tiger.html" target="_top">TIGER/Line file sets</a>,
        </p></li><li><p><a name="c36b2b2c11b3b4"/>
        <a href="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_ogdi.html" target="_top">OGDI Vectors</a>,
        </p></li><li><p><a name="c36b2b2c11b3b5"/>
        <a href="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_s57.html" target="_top">IHO S-57 datasets</a>,
        </p></li><li><p><a name="c36b2b2c11b3b6"/>
        <a href="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_ntf.html" target="_top">UK.NTF</a> (National Transfer Format),
        </p></li><li><p><a name="c36b2b2c11b3b7"/>
        <a href="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_sdts.html" target="_top">SDTS TVP</a> (Topological Vector Profile and Point Profile datasets),
        </p></li><li><p><a name="c36b2b2c11b3b8"/>
        <a href="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_pg.html" target="_top">PostgreSQL</a>.
        </p></li></ul></div><p>
            <i>Note1: Some of the above formats (e.g. OGDI) have external dependencies
               and are not always included in the precompiled binary distributions of MapServer with OGR support.
            </i>
        </p>
        <p>
            <i>Note2: Some of the above formats are not well suited
                for random access by nature, that's the case of MapInfo MIF/MID files which is a
                TEXT format and will give very poor performance for a web application.
                On the other hand, some binary formats such as MapInfo TAB are better suited for
                random access and will give performance comparable to native shapefile access
                in Mapserver.
            </i>
        </p></div>
        <div class="sect2"><a name="information"/><div class="titlepage">
        <div><h3 class="title"><a name="information"/><span class="title">How to Get More Information on the OGR Project</span></h3></div></div><p>
            More information on the OGR Simple Features Project can be found at
            <a href="http://gdal.velocet.ca/projects/opengis/" target="_top">
            http://gdal.velocet.ca/projects/opengis/</a>.
            </p>
            <p>
              The main developer of the OGR library is Frank Warmerdam.
              <div class="address"><br/>
              <tt>&lt;<a href="mailto:warmerda@home.com">warmerda@home.com</a>&gt;</tt><br/>
              </div>
            </p>
            <p>
               The integration of OGR within MapServer was done by Daniel Morissette.
               <div class="address"><br/>
               <tt>&lt;<a href="mailto:morissette@dmsolutions.ca">morissette@dmsolutions.ca</a>&gt;</tt><br/>
               </div>
            </p></div></div>
        <div class="sect1"><a name="obtain"/>
        <div class="titlepage">
        <div><h2 class="title" style="clear: all"><a name="obtain"/><span class="title">Obtaining and Compiling MapServer with OGR Support</span></h2></div></div><p>
          <i>TODO: this is still incomplete</i>
        <div class="itemizedlist"><ul><li><p><a name="c36b2b4b2b4b1"/>
           Follow the instructions on the OGR page to compile/install OGR (actually GDAL since OGR is part of the GDAL library):
           <a href="http://gdal.velocet.ca/projects/opengis/" target="_top">http://gdal.velocet.ca/projects/opengis/</a>.
           </p></li><li><p><a name="c36b2b4b2b4b2"/>
           Obtain the MapServer source from: <a href="http://mapserver.gis.umn.edu/dload.html" target="_top">http://mapserver.gis.umn.edu/dload.html</a>.
           </p></li></ul>
        </div></p>
        <p>
          For UNIX users, see the <i>README.CONFIGURE</i> file in the MapServer source, or see
          the UNIX/MapServer HOWTO at <a href="http://mapserver.gis.umn.edu/doc/unix-install-howto.html" target="_top">					http://mapserver.gis.umn.edu/doc/unix-install-howto.html</a>.
        </p>
        <p>
          For Windows users, it is recommended to look for a precompiled binary on the MapServer
           site at <a href="http://mapserver.gis.umn.edu/win32binaries.html" target="_top">http://mapserver.gis.umn.edu/win32binaries.html</a>
           (<i>Unfortunately there is no 3.5 executable with OGR support on this site yet.</i>).
           If you want to compile your own then see the <i>README.WIN32</i> file in the MapServer source.
        </p></div>
        <div class="sect1"><a name="integrate"/><div class="titlepage"><div><h2 class="title" style="clear: all"><a name="integrate"/><span class="title">Integrating OGR Support with MapServer Applications</span></h2></div></div><p>
          The only change that is needed to integrate OGR support with a MapServer
          application is with the .map file.  The LAYER's DATA parameter is replaced by
          two parameters (CONNECTIONTYPE OGR, and CONNECTION):
        </p>
        <pre class="programlisting">
      LAYER
         ...
         CONNECTIONTYPE OGR
         CONNECTION "ogr_connection_string"
         ...
      END
        </pre><p>
           -where the "ogr_connection_string" is:  &lt;dataset_filename&gt;[,&lt;layer_index&gt;].
        </p><p>
           &lt;dataset_filename&gt;  is:
        </p><p>
      <div class="itemizedlist"><ul><li><p><a name="c36b2b6b6b2b1"/>
          the filename of the data set (including the extension);
          </p></li><li><p><a name="c36b2b6b6b2b2"/>
          this is the location of the file relative to the location of the .map file.
          </p></li></ul>
      </div></p>
      <!--<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a name="c36b2b6b7">Note</a></h3><p>
          The SHAPEPATH parameter is ignored when accessing OGR data sources.
          </p>
      </div> -->
          <p><b>NOTE:</b> The SHAPEPATH parameter is ignored when accessing OGR data sources.</p>
          <p>
          &lt;layer_index&gt; is:
          </p><p>
      <div class="itemizedlist"><ul><li><p><a name="c36b2b6b9b2b1"/>
          optional,
      </p></li><li><p><a name="c36b2b6b9b2b2"/>
          the OGR layer index number,
          </p></li><li><p><a name="c36b2b6b9b2b3"/>
          0 by default (the first layer).
          </p></li></ul>
      </div>
          </p><p>
          The OGRINFO program can be used to find out the layer indices in a data set.
          </p>
      <div class="sect2"><a name="examples"/>
      <div class="titlepage"><div><h3 class="title"><a name="examples"/>
      <span class="title">Examples of Layer Definitions Using OGR</span></h3></div></div><div class="example"><p><a name="c36b2b6c12b2"/><b>Example 1.
          MapInfo TAB file
          </b></p>
      <pre class="programlisting">
      LAYER
         NAME "Builtup_Areas_tab"
         TYPE POLYGON
         CONNECTIONTYPE OGR
         CONNECTION "data/tab/092b06_builtup_a.tab"
         STATUS ON
         CLASS
           ...
         END
      ...
      END
      </pre></div>
      <div class="example"><p><a name="c36b2b6c12b3"/>
         <b>Example 2.TIGER/Line file
         </b></p>
      <pre class="programlisting">
      LAYER
         NAME "Roads_tig"
         TYPE LINE
         CONNECTIONTYPE OGR
         CONNECTION "data/tgr_roads.rt1"
         STATUS ON
         CLASS
           ...
         END
      ...
      END
      </pre></div></div>
      <div class="sect2"><a name="ogrinfo"/>
      <div class="titlepage">
      <div><h3 class="title"><a name="ogrinfo"/>
      <span class="title">How to Use "OGRINFO"</span></h3></div></div><p>
        OGRINFO is part of the GDAL/OGR distribution.  It is an executable that can be used
        to obtain layer information about OGR supported files.  The parameters
        are:
      </p>
      <pre class="programlisting">
        ogrinfo [-ro] [-q] datasource_name [layer [layer...]]
      </pre>
      <div class="itemizedlist"><ul><li><p><a name="c36b2b6c14b4b1"/>
        -ro opens the file as read only (optional)
        </p></li><li><p><a name="c36b2b6c14b4b2"/>
        -q executes in quiet mode, only the layer idex line will be returned (optional)
        </p></li><li><p><a name="c36b2b6c14b4b3"/>
        datasource_name is the filename including extension (eg. roads.tab)
        </p></li></ul></div>
        <div class="sect3"><a name="example"/>
        <div class="titlepage">
        <div><h4 class="title"><a name="example"/><span class="title">Examples of OGRINFO in use:</span></h4></div></div>
        <div class="example"><p><a name="c36b2b6c14b5b2"/><b>Example 3.
        To get the list of layers in a file:
        </b></p>
      <pre class="programlisting">
        $ ogrinfo  popplace.tab

        Had to open data source read-only.
        INFO: Open of `popplace.tab'
        using driver `MapInfo File' successful.
        1: popplace (Point)
      </pre><p>
      <div class="literallayout">   which shows that there is one point layer in the popplace.tab file.
      </div>
      </p></div>
      <div class="example"><p><a name="c36b2b6c14b5b3"/>
         <b>Example 4.
            To get a dump of a specific layer, including field names, projection, etc:
         </b></p>
      <pre class="programlisting">
        $ ogrinfo popplace.tab popplace

        Had to open data source read-only.
        INFO: Open of `popplace.tab'
        using driver `MapInfo File' successful.

        Layer name: popplace
        Geometry: Point
        Feature Count: 497
        Layer SRS WKT: PROJCS["unnamed",GEOGCS["unnamed",DATUM["North ...snipped...
        AREA: Real (15.3)
        PERIMETER: Real (15.3)
        POPPLACE_: Real (11.0)
        POPPLACE_I: Real (15.0)
        NAME: String (50.0)
        OGRFeature(popplace):1
          AREA (Real) =           0.000
          PERIMETER (Real) =           0.000
          POPPLACE_ (Real) =           1
          POPPLACE_I (Real) =               1
          NAME (String) = Port Hope Simpson
          POINT (2437287.249 1153656.751)

        OGRFeature(popplace):2
          AREA (Real) =           0.000
          PERIMETER (Real) =           0.000
          POPPLACE_ (Real) =           2
          POPPLACE_I (Real) =               1
          NAME (String) = Hopedale

        ...
        ...
       </pre></div></div></div>
       <div class="sect2"><a name="queries"/><div class="titlepage">
       <div><h3 class="title"><a name="queries"/>
       <span class="title">Queries Through OGR Format</span></h3></div></div><p>
          OGR layers can be queried the same way as regular shapefiles in MapServer.
       </p></div>
       <div class="sect2"><a name="formatinfo"/>
       <div class="titlepage">
       <div><h3 class="title"><a name="formatinfo"/>
       <span class="title">Format-Specific Information</span></h3>
       </div></div><p>
          This section will contain any format-specific issues that are discovered over time.
          </p></div></div><div class="sect1"><a name="FAQ"/><div class="titlepage"><div><h2 class="title" style="clear: all"><a name="FAQ"/><span class="title">FAQ / Common Problems</span></h2></div></div><div class="sect2"><a name="c36b2b8b2"/><div class="titlepage"><div><h3 class="title"><a name="c36b2b8b2"/><span class="title">What Does "OGR" Stand For?</span></h3></div></div><p>
          Basically, OGR does not stand for anything.  For a detailed explanation of how OGR was named, see Frank
          Warmerdam's OGR site at <a href="http://gdal.velocet.ca/projects/opengis" target="_top"> 					              http://gdal.velocet.ca/projects/opengis</a> in the section 'OGR and OpenGIS'.
       </p></div></div>
       <div class="sect1"><a name="docinfo"/>
       <div class="titlepage">
       <div><h2 class="title" style="clear: all"><a name="docinfo"/>
       <span class="title">About This Document</span></h2>
       </div></div>
       <div class="sect2"><a name="copyright"/>
       <div class="titlepage"><div><h3 class="title"><a name="copyright"/>
       <span class="title">Copyright Information</span></h3></div></div><p>
          Copyright (c) 2001, Jeff McKenna, DM Solutions Group Inc.
          </p><p>
          This documentation is covered by the same Open Source license as the
          MapServer software itself.  See MapServer's
          <a href="http://mapserver.gis.umn.edu/license.html" target="_top">License and
          Credits</a> page for the complete text.
          </p></div><div class="sect2"><a name="disclaimer"/><div class="titlepage"><div><h3 class="title"><a name="disclaimer"/><span class="title">Disclaimer</span></h3></div></div><p>
          No liability for the contents of this document can be accepted.
          Use the concepts, examples and other content at your own risk.
          As this is a new edition of this document, there may be errors
          and inaccuracies that may be damaging to your system.
          Although this is highly unlikely, the author(s) do not take any
          responsibility for that:  proceed with caution.
                </p></div><div class="sect2"><a name="feedback"/><div class="titlepage"><div><h3 class="title"><a name="feedback"/><span class="title">Feedback</span></h3></div></div><p>
          This is a new document for a new project; input is appreciated.  Send any
          comments or suggestions to the MapServer Documentation Coordinator at
          <tt>&lt;<a href="mailto:mdp@lists.gis.umn.edu">mdp@lists.gis.umn.edu</a>&gt;</tt>.
       </p></div></div></div>
    </body>
 </html>